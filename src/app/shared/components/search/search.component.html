<div class="container-fluid">
  <div class="mt-4 row">
    <div class="my-auto col-2 text-end">
      <h2 class="text-3xl font-bold">Alva Search</h2>
    </div>
    <div class="col-6">
      <div class="search-container">
        <input id="question_input" class="search-input" [formControl]="query" type="text" (keyup.enter)="sendQuery()"
          placeholder="Ask anything..." />
        <button class="search-icon-button" (click)="sendQuery()" title="Search" aria-label="Search"
          [disabled]="!isConnected || isGenerating">
          <i class="fas fa-search"></i>
        </button>
      </div>
    </div>
    <div class="col-2"></div>
  </div>
  <!-- <p>{{messages | json}}</p> -->
  <div class="row justify-content-end">
    <div class="col-8" *ngIf="!isConnected">
      <p class="status-text connecting">Connecting...</p>
    </div>
    <div class="col-5" *ngIf="messages.length > 0">
      @for(msg of messages; track msg.timestamp) {
        @if (msg.sender === 'user') {
          <div class="user-query">
            <h1><i class="bi bi-robot"></i> {{ msg.content }}</h1>
          </div>
        }

        <!-- AI response -->
        @if (msg.sender === 'ai bot') {
          <div class="px-0 container-fluid">
            <div class="row">
              <div class="col">
                <!-- <p *ngIf="isGenerating && msg.content.length > 0" class="status-text generating streaming">Streaming response...</p> -->
                <div class="response-content" [innerHTML]="formatAndSanitize(msg.content | linkIcon)"></div>
                <!-- <p *ngIf="!isGenerating && msg.content.length > 0" class="status-text complete">Response complete.</p> -->
              </div>
            </div>
          </div>
        }
      }
    </div>
    <div class="mt-5 col-3" *ngIf="messages.length > 0">
      @for(msg of messages; track msg.timestamp) {
        <!-- AI response -->
        @if (msg.sender === 'ai bot') {
          @for (item of getTitles(msg.content); track $index) {
            <div class="mb-1 card">
              <div class="font-bold card-header">
                <a *ngIf="item.urls && item.urls.length === 1" [href]="item.urls[0]">{{item.title}}</a>
                <span *ngIf="item.urls && item.urls.length === 0">{{item.title}}</span>
                <dl *ngIf="item.urls && item.urls.length > 1">
                  <dt>{{item.title}}</dt>
                  <ul class="list-inline">
                    * <li class="list-inline-item" *ngFor="let link of item.urls" [innerHTML]="link | linkIcon"></li>
                  </ul>
                </dl>
              </div>
            </div>
          }
        }
      }
    </div>
    <div class="col-2"></div>
  </div>
</div>
